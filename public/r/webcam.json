{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "webcam",
  "title": "Webcam",
  "description": "A browser webcam streaming component with error handling and ref forwarding. | ブラウザのウェブカメラストリーミング用コンポーネント。エラー処理とref転送機能付き。",
  "files": [
    {
      "path": "components/media/webcam.tsx",
      "content": "\"use client\";\r\n\r\nimport { forwardRef, useRef, useState, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// default video and audio settings\r\nconst mediaConfig = {\r\n  video: {\r\n    width: 640,\r\n    height: 360,\r\n    facingMode: \"user\",\r\n  },\r\n  audio: false,\r\n  errorMessage: \"Unable to access camera\",\r\n};\r\n\r\nfunction mergeRefs<T>(\r\n  ref: React.Ref<T> | undefined,\r\n  localRef: React.MutableRefObject<T | null>,\r\n) {\r\n  return (el: T | null) => {\r\n    localRef.current = el;\r\n    if (typeof ref === \"function\") ref(el);\r\n    else if (ref) (ref as React.MutableRefObject<T | null>).current = el;\r\n  };\r\n}\r\n\r\ninterface WebcamProps {\r\n  width?: number; // Video width, default: 640\r\n  height?: number; // Video height, default: 360\r\n  audio?: boolean; // Audio, default: false\r\n  className?: string; // <video> Class name\r\n  containerClassName?: string; // Container class name\r\n}\r\n\r\nexport const Webcam = forwardRef<HTMLVideoElement, WebcamProps>(function Webcam(\r\n  {\r\n    width = mediaConfig.video.width,\r\n    height = mediaConfig.video.height,\r\n    audio = mediaConfig.audio,\r\n    className,\r\n    containerClassName,\r\n  },\r\n  ref,\r\n) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    let stream: MediaStream | null = null;\r\n\r\n    async function initCamera() {\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: {\r\n            width: width,\r\n            height: height,\r\n            facingMode: mediaConfig.video.facingMode,\r\n          },\r\n          audio: audio,\r\n        });\r\n        if (videoRef.current) videoRef.current.srcObject = stream;\r\n      } catch (err) {\r\n        setError(\r\n          err instanceof Error ? `${err.message}` : mediaConfig.errorMessage,\r\n        );\r\n      }\r\n    }\r\n\r\n    initCamera();\r\n    return () => {\r\n      stream?.getTracks().forEach((track) => track.stop());\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"relative flex items-center justify-center w-full h-full\",\r\n        containerClassName,\r\n      )}\r\n    >\r\n      {error ? (\r\n        <p\r\n          role=\"alert\"\r\n          className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-red-500\"\r\n        >\r\n          {error}\r\n        </p>\r\n      ) : null}\r\n      <video\r\n        ref={mergeRefs(ref, videoRef)}\r\n        autoPlay\r\n        playsInline\r\n        muted\r\n        className={cn(\r\n          \"w-full h-full aspect-video bg-black object-cover scale-x-[-1] rounded-xs\",\r\n          className,\r\n        )}\r\n      />\r\n    </div>\r\n  );\r\n});\r\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}